Public Function dpe(data As Variant, projectname As Range, methodname As Range) As Variant
On Error GoTo errorhandler

If CDec(data) <= pl(projectname, methodname).analysis_method_Detection Then
    dpe = pl(projectname, methodname).analysis_method_Detection & "L"
Else
    If pl(projectname, methodname).analysis_method_Divdevalue = "" Then
        If CDec(data) < 1 And Abs(CDec(data)) < 1 Then
                If pl(projectname, methodname).analysis_method_Decimal <= Len(Split(CDec(data), ".")(1)) Then
                    If pl(projectname, methodname).analysis_method_Decimal = 0 Then
                        dpe = WorksheetFunction.Text(datad(data, pl(projectname, methodname).analysis_method_Decimal), "0" & WorksheetFunction.Rept("0", pl(projectname, methodname).analysis_method_Decimal))
                    Else
                        dpe = WorksheetFunction.Text(datad(data, pl(projectname, methodname).analysis_method_Decimal), "0." & WorksheetFunction.Rept("0", pl(projectname, methodname).analysis_method_Decimal))
                    End If
                Else
                    If pl(projectname, methodname).analysis_method_Significantfigure + Len(Split(CDec(data), ".")(1)) - Len(Split(CDec(data), ".")(1) * 1) > pl(projectname, methodname).analysis_method_Decimal Then
                        dpe = WorksheetFunction.Text(datas(data, pl(projectname, methodname).analysis_method_Significantfigure), "0." & WorksheetFunction.Rept("0", pl(projectname, methodname).analysis_method_Decimal))
                    Else
                        dpe = WorksheetFunction.Text(datas(data, pl(projectname, methodname).analysis_method_Significantfigure), "0." & WorksheetFunction.Rept("0", pl(projectname, methodname).analysis_method_Significantfigure + Len(Split(CDec(data), ".")(1)) - Len(Split(CDec(data), ".")(1) * 1)))
                    End If
                End If
        Else
                If pl(projectname, methodname).analysis_method_Significantfigure <= Len(Split(CDec(data), ".")(0) * 1) Then
                    dpe = datas(data, pl(projectname, methodname).analysis_method_Significantfigure)
                Else
                    If pl(projectname, methodname).analysis_method_Significantfigure - Len(Split(CDec(data), ".")(0) * 1) <= pl(projectname, methodname).analysis_method_Decimal Then
                        dpe = WorksheetFunction.Text(datas(data, pl(projectname, methodname).analysis_method_Significantfigure), "0." & WorksheetFunction.Rept("0", pl(projectname, methodname).analysis_method_Significantfigure - Len(Split(CDec(data), ".")(0) * 1)))
                    Else
                        If pl(projectname, methodname).analysis_method_Decimal = 0 Then
                            dpe = WorksheetFunction.Text(datad(data, pl(projectname, methodname).analysis_method_Decimal), "0" & WorksheetFunction.Rept("0", pl(projectname, methodname).analysis_method_Decimal))
                        Else
                            dpe = WorksheetFunction.Text(datad(data, pl(projectname, methodname).analysis_method_Decimal), "0." & WorksheetFunction.Rept("0", pl(projectname, methodname).analysis_method_Decimal))
                        End If
                    End If
                End If
        End If
    Else
        If CDec(data) < pl(projectname, methodname).analysis_method_Divdevalue Then
            If pl(projectname, methodname).analysis_method_divdevalue_Decimal = 0 Then
                dpe = WorksheetFunction.Text(datad(data, pl(projectname, methodname).analysis_method_divdevalue_Decimal), "0" & WorksheetFunction.Rept("0", pl(projectname, methodname).analysis_method_divdevalue_Decimal))
            Else
                dpe = WorksheetFunction.Text(datad(data, pl(projectname, methodname).analysis_method_divdevalue_Decimal), "0." & WorksheetFunction.Rept("0", pl(projectname, methodname).analysis_method_divdevalue_Decimal))
            End If
        Else
            If pl(projectname, methodname).analysis_method_divdevalue_Significantfigure <= Len(Split(CDec(data), ".")(0) * 1) Then
                dpe = datas(data, pl(projectname, methodname).analysis_method_divdevalue_Significantfigure)
            Else
                dpe = WorksheetFunction.Text(datas(data, pl(projectname, methodname).analysis_method_divdevalue_Significantfigure), "0." & WorksheetFunction.Rept("0", pl(projectname, methodname).analysis_method_divdevalue_Significantfigure - Len(Split(CDec(data), ".")(0) * 1)))
            End If
        End If
    End If
End If

errorhandler:
Exit Function
End Function
